<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Page</title>
    <link href="https://fonts.googleapis.com/css2?family=Alike+Angular&family=Alkatra&display=swap" rel="stylesheet">
    <script src="footer.js" defer></script>
    <script src="appearance.js" defer></script>
    <link rel="stylesheet" href="appearance.css">
    <link rel="stylesheet" href="assist.css">

    <style>
        body {
            font-family: "Alike Angular", sans-serif;
            background: #ebadad;
            padding-top: 80px;
            padding-bottom: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-y: auto;
        }

        /* Back Button */
        .back-logo {
            position: absolute;
            top: 30px;
            left: 20px;
        }

        .back-logo img {
            width: 10px;
            height: auto;
            cursor: pointer;
        }

        .settings-title {
            width: 90%;
            max-width: 500px;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: left;
            margin-left: 0px;
        }
        

        .settings-container {
            width: 97%;
            max-width: 900px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .section-title {
            background: #eee;
            padding: 8px;
            font-weight: bold;
            margin-top: -2px;
            font-size: 17px;
        }

        .setting-item {
    padding: 10px 10px; /* Added left padding */
    cursor: pointer;
    font-size: 17px;
    color: inherit;
    text-decoration: none;
    display: block;
    width: 100%; /* Ensures full width */
    box-sizing: border-box; /* Prevents width issues */
}

.setting-item:hover {
    background: #f0f0f0;
}

        .divider {
            height: 1px;
            background: #ddd;
            margin: 0 10px;
        }

        a {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .button {
            width: 90px;
            height: 29px;
            background: #f72222;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-family: "Alkatra", sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            cursor: pointer;
        }
        
        
        .footer {
            background-color: rgb(255, 255, 255);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px; /* Increased height */
            display: flex;
            justify-content: space-between; /* Ensures no gap */
            align-items: flex-end;
            padding: 10px 0; /* Increased padding for better spacing */
            z-index: 1000; /* Ensures footer stays above other elements */
        }

        .footer-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .footer-button {
            text-decoration: none;
            color: black;
            text-align: center;
            font-size: 14px; /* Improved text readability */
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            line-height: 1; /* Ensures no extra spacing between text and image */
        }

        .footer-button img {
            width: 24px; /* Larger icons for better visibility */
            height: 24px;
            filter: grayscale(100%);
            transition: filter 0.3s ease, transform 0.3s ease; /* Added smooth scaling */
            margin-bottom: 5px; /* Improved spacing */
        }

        .footer-button span {
            margin-top: 8px; /* Better spacing for text */
        }

        .footer-button:hover img {
            filter: grayscale(0%);
            transform: scale(1.1); /* Slight zoom effect on hover */
        }

        /* Moving Underline */
        .underline {
            position: absolute;
            bottom: 70px; /* Aligned with increased footer height */
            height: 5px; /* Slightly thicker underline for visibility */
            background-color: black;
            width: 50px;
            transition: transform 0.3s ease, left 0.3s ease;
        }

        .loading-overlay {
            position: fixed;
            top: 0px; /* Moves the overlay up */
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark background with transparency */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 20px;
            z-index: 9999; /* Ensure it appears above everything */
        }

        .hidden {
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ffffff;
            border-top: 4px solid #ff6f6f; /* Highlight spinner */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        
/* Dark Mode - Settings Title */
.dark-mode .settings-title {
    color: #fff; /* White text for better contrast */
}

/* Dark Mode - Settings Container */
.dark-mode .settings-container {
    background: #222; /* Dark background */
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); /* Softer shadow */
}

/* Dark Mode - Section Title */
.dark-mode .section-title {
    background: #333; /* Slightly lighter dark shade */
    color: #ddd; /* Soft white text */
}

/* Dark Mode - Setting Item */
.dark-mode .setting-item {
    color: #ddd; /* Lighter text */
}

.dark-mode .setting-item:hover {
    background: #444; /* Slightly lighter hover */
}

/* Dark Mode - Divider */
.dark-mode .divider {
    background: #555; /* Darker divider */
}


    </style>
</head>
<body>

    <img src="static/Picsart_25-03-06_14-08-38-557.png" alt="Ball" class="ball" id="ball">

    <div class="back-logo">
        <a href="N-foodinterfacepage.html" class="back-log">
            <div class="back-loco">
                <img src="static/pngkey.com-menu-icon-png-9694963.png" alt="back-button">
            </div>
        </a>
    </div>

    <script>
        // Get the back button element
        const backButton = document.getElementById("backButton");
    
        // Add an event listener to handle the back action
        backButton.addEventListener("click", function() {
            window.history.back(); // Go back to the previous page
        });
    </script>
    
     <div class="settings-title">Settings</div>
    <div class="settings-container">
        <div class="section-title">Display</div>
        <a href="appearance.html"><div class="setting-item">Appearance</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="language.html"><div class="setting-item">Language</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="notification.html"><div class="setting-item">Notification</div></a>


        <div class="section-title">Food Orders</div>
        <a href="ordered.html"><div class="setting-item">Orders</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="order_on_train.html"><div class="setting-item">Order On Train</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="addresssaved.html"><div class="setting-item">Address Book</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="hidden_restaurants.html"><div class="setting-item">Hidden Restaurants</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="couponscode.html"><div class="setting-item">Coupons</div></a>
    

        <div class="section-title">Events</div>
        <a href="event_tickets.html"><div class="setting-item">Your Event Tickets</div></a>
       
        <div class="section-title">Money</div>
        <a href="money.html"><div class="setting-item">Cookies Money</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="giftcardstore.html"><div class="setting-item">Gift Card</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="giftcards.html"><div class="setting-item">Buy Gift Card</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="claimgift.html"><div class="setting-item">Claim Gift Card</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="credits.html"><div class="setting-item">Cookies Credits</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="payment-options.html"><div class="setting-item">Payment Settings</div></a>
       

        <div class="section-title">Cookie Enterprise</div>
        <a href="employees.html"><div class="setting-item">For Employees</div></a>

      

        <div class="section-title">More</div>
        <a href="sent_feedback.html"><div class="setting-item">Sent Feedback</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="receipt.html"><div class="setting-item">Get Feeding India Receipt</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="cookies-chat.html"><div class="setting-item">Cookies Live Support</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="cookieassist.html"><div class="setting-item">Cookies Assist Help</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="safety_emergency.html"><div class="setting-item">Report a Safety Emergency</div></a>
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="deleteaccount.html"><div class="setting-item">Delete Your Account</div>
        </a>
        
        <div class="divider"></div> <!-- Divider after setting item -->
        <a href="about.html"><div class="setting-item">About</div></a>
    </div>

    <div>
        <a href ="N-foodloginpage.html" class ="button">Log out</a>
    </div>

    <div id="loading-screen" class="loading-overlay hidden">
        <div class="spinner"></div>
        <span>Logging out...</span>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const logoutButton = document.querySelector(".button");

            logoutButton.addEventListener("click", function (event) {
                event.preventDefault(); // Prevent immediate navigation

                // Show loading screen before redirect
                const loadingScreen = document.getElementById("loading-screen");
                loadingScreen.classList.remove("hidden"); // Show loading screen

                setTimeout(() => {
                    window.location.href = "N-foodloginpage.html"; // Redirect after 5 seconds
                }, 5000); // 5 seconds delay
            });
        });
    </script>

    <script>

let ball = document.getElementById("ball");
let isDragging = false;
let offsetX, offsetY;

// Create message container dynamically
let message = document.createElement("div");
message.classList.add("message");
document.body.appendChild(message);

function typeMessage(text, duration, callback) {
    let index = 0;
    let tempText = "";
    message.innerHTML = ""; // Clear previous text
    updateMessagePosition();

    message.style.opacity = "1";
    message.style.transform = "translateY(0)";
    
    function typeNextLetter() {
        if (index < text.length) {
            tempText += text[index] === " " ? "&nbsp;" : text[index]; // Preserve spaces
            message.innerHTML = tempText;
            index++;
            setTimeout(typeNextLetter, 40); // Typing speed
        } else {
            // Keep the message visible longer
            setTimeout(() => {
                if (callback) {
                    callback(); // Move to next message only when user is ready
                }
            }, duration); // Only trigger next step after full duration
        }
    }

    typeNextLetter();
}


// ✅ Run check when page loads
window.onload = checkAssistStatus;

function checkMissingInfo() {
    let savedAddresses = JSON.parse(localStorage.getItem("addresses")) || [];
    let activeAddress = localStorage.getItem("activeAddress");
    let savedNumbers = JSON.parse(localStorage.getItem("phoneNumbers")) || [];
    let activeNumber = localStorage.getItem("activeNumber");
    let savedImage = localStorage.getItem("profileImage");
    let savedLocations = JSON.parse(localStorage.getItem("savedAddresses")) || [];
    let orderedProducts = JSON.parse(localStorage.getItem("orderedProducts") || "[]");

    let hasAddress = activeAddress && savedAddresses.length > 0;
    let hasPhone = activeNumber && savedNumbers.length > 0;
    let defaultImage = "static/profileupdate.png"; // Default profile image path
    let hasProfileImage = savedImage && savedImage !== "" && savedImage !== defaultImage;
    let hasLocation = savedLocations.length > 0;
    let hasActiveOrder = orderedProducts.length > 0;

    if (!hasAddress && !hasPhone && !hasProfileImage && !hasLocation) {
        typeMessage("Please set your profile image, address, phone number, and location in Profile or Settings.", 3000);
    } else if (!hasAddress && !hasPhone) {
        typeMessage("Please set your address and phone number in Profile or Settings Address Book", 3000);
    } else if (!hasAddress) {
        typeMessage("Please set your address in Profile or Settings Address Book", 3000);
    } else if (!hasPhone) {
        typeMessage("Please set your phone number in Profile or Settings Address Book", 3000);
    } else if (!hasLocation) {
        typeMessage("Please set your location in Profile or Settings.", 3000);
    }

    if (!hasProfileImage) {
        typeMessage("Please set your profile image in Profile settings.", 3000);
    }

    if (hasActiveOrder) {
        typeMessage("Go and check out your track order, which is below (Track). Your order is on the way!", 4000);
    }
}

function updateMessagePosition() {
    let x = ball.offsetLeft;
    let y = ball.offsetTop;
    let maxX = window.innerWidth - ball.clientWidth;
    let messageWidth = message.clientWidth;

    if (x > maxX / 2) {
        let newLeft = x - messageWidth - 10;
        message.style.left = newLeft < 0 ? "10px" : newLeft + "px";
    } else {
        let newLeft = x + 70;
        message.style.left = newLeft + messageWidth > window.innerWidth 
            ? (window.innerWidth - messageWidth - 10) + "px" 
            : newLeft + "px";
    }

    message.style.top = (y - -3) + "px";
    message.style.display = "block";
}

function smoothUpdate() {
    updateMessagePosition();
    requestAnimationFrame(smoothUpdate);
}
smoothUpdate(); 

// 🟢 Check Assist Mode (ON/OFF) when page loads
function checkAssistStatus() {
    let isAssistOn = localStorage.getItem("cookieAssist") === "on";
    if (!isAssistOn) {
        ball.style.display = "none";
        message.style.display = "none";
    } else {
        ball.style.display = "block";
        message.style.display = "block";
        checkMissingInfo();
    }
}

// 🟢 Make ball draggable
ball.addEventListener("mousedown", (e) => {
    isDragging = true;
    offsetX = e.clientX - ball.offsetLeft;
    offsetY = e.clientY - ball.offsetTop;
    ball.style.cursor = "grabbing";
});

document.addEventListener("mousemove", (e) => {
    if (isDragging) {
        let x = e.clientX - offsetX;
        let y = e.clientY - offsetY;

        let maxX = window.innerWidth - ball.clientWidth;
        let maxY = window.innerHeight - ball.clientHeight;

        // Constrain movement within screen bounds
        x = Math.max(0, Math.min(maxX, x));
        y = Math.max(0, Math.min(maxY, y));

        ball.style.top = y + "px";
        ball.style.left = x + "px";
    }
});

// Touch Events for Mobile
ball.addEventListener("touchstart", (e) => {
    isDragging = true;
    const touch = e.touches[0];
    offsetX = touch.clientX - ball.offsetLeft;
    offsetY = touch.clientY - ball.offsetTop;
    ball.style.cursor = "grabbing";
}, { passive: false });

document.addEventListener("touchmove", (e) => {
    if (isDragging) {
        const touch = e.touches[0];
        let x = touch.clientX - offsetX;
        let y = touch.clientY - offsetY;

        let maxX = window.innerWidth - ball.clientWidth;
        let maxY = window.innerHeight - ball.clientHeight;

        x = Math.max(0, Math.min(maxX, x));
        y = Math.max(0, Math.min(maxY, y));

        ball.style.left = x + "px";
        ball.style.top = y + "px";

        e.preventDefault(); // ✋ Stop default scroll
    }
}, { passive: false });

document.addEventListener("touchend", () => {
    if (isDragging) {
        let maxX = window.innerWidth - ball.clientWidth;
        let x = ball.offsetLeft;

        if (x > maxX / 2) {
            ball.style.left = maxX + "px";
        } else {
            ball.style.left = "0px";
        }
    }
    isDragging = false;
    ball.style.cursor = "grab";
});


document.addEventListener("mouseup", () => {
    if (isDragging) {
        isDragging = false;
        ball.style.cursor = "grab";

        let maxX = window.innerWidth - ball.clientWidth;
        let currentX = ball.offsetLeft;

        // Snap to nearest edge (left or right)
        let snapX = currentX < maxX / 2 ? 0 : maxX;  

        // Smooth transition to the edge
        ball.style.transition = "left 0.3s ease";
        ball.style.left = snapX + "px";

        // Remove transition after animation to keep smooth dragging
        setTimeout(() => {
            ball.style.transition = "";
        }, 300);
    }
});

let lastTap = 0;
let isMessageActive = false; // Prevent multiple activations

ball.addEventListener("click", handleDoubleTap);
ball.addEventListener("touchend", handleDoubleTap);

function handleDoubleTap(e) {
    e.preventDefault(); // Prevent unwanted zooming on mobile
    let currentTime = new Date().getTime();
    let tapLength = currentTime - lastTap;

    if (tapLength < 300 && tapLength > 0) { // Double-tap detected
        console.log("Double tap detected! Attempting to show help messages.");

        if (!isMessageActive) { // Prevent overlapping messages
            isMessageActive = true;
            showHelpMessages(() => {
                console.log("Finished displaying help messages.");
                isMessageActive = false; // Reset flag after sequence completes
            });
        } else {
            console.log("Help messages already active. Ignoring double-tap.");
        }
    }

    lastTap = currentTime;
}

// Ensure event listener is correctly applied
document.getElementById("ball").addEventListener("dblclick", handleDoubleTap); // 🟢 Use `dblclick`
document.getElementById("ball").addEventListener("touchend", handleDoubleTap);


function typeMessage(text, duration, callback) {
    let index = 0;
    let tempText = "";
    message.innerHTML = ""; // Clear previous text
    updateMessagePosition();

    message.style.opacity = "1";
    message.style.transform = "translateY(0)";

    function typeNextLetter() {
        if (index < text.length) {
            tempText += text[index] === " " ? "&nbsp;" : text[index]; // Preserve spaces
            message.innerHTML = tempText;
            index++;
            setTimeout(typeNextLetter, 40); // Typing speed
        } else {
            setTimeout(() => {
                message.style.opacity = "0";
                message.style.transform = "translateY(10px)";
                if (callback) setTimeout(callback, 1000);
            }, duration + 1000);
        }
    }

    typeNextLetter();
}

function showHelpMessages(callback) {
    let isAssistOn = localStorage.getItem("cookieAssist") === "on";
    if (!isAssistOn) return; // ✅ Prevent messages from showing when assist is OFF
    
    typeMessage("Feel like you need help? Wait, let me guess!", 3000, () => {
        typeMessage("If you want to change your username, email, or phone number, go to Profile (on the Dining page, click the top-right image).", 4000, () => {
            setTimeout(() => {
                typeMessage("If you have any errors in payment, click Payment Settings below.", 4000, () => {
                    setTimeout(() => {
                        typeMessage("If you want to update your saved address, go to the Address Book below.", 5000, () => {
                            setTimeout(() => {
                                typeMessage("If you want to delete your account, scroll down and select 'Delete Your Account'. Don't forget to provide feedback so we can improve our website.", 4000, () => {
                                    setTimeout(() => {
                                        typeMessage("If you need more help, you can chat with our Cookies customer support 💬. Click 'Cookies Live Support' below.", 5000, () => {
                                            setTimeout(() => {
                                                typeMessage("If you want to see your event tickets, just go below and click 'Your Event Tickets'.", 4000, () => {
                                                    setTimeout(() => {
                                                        typeMessage("If you want to buy a gift card, go below and click 'Buy Gift Card'.", 4000, () => {
                                                            setTimeout(() => {
                                                                typeMessage("Or if you want to claim a gift card, just go below and select 'Claim Gift Card'.", 4000, () => {
                                                                    setTimeout(() => {
                                                                        typeMessage("If you want to see your purchased transactions, just go below and click 'Cookies Credits'.", 4000, () => {
                                                                            setTimeout(() => {
                                                                                typeMessage("If you want to turn off notifications, go to 'Notification', which is above here.", 4000, () => {
                                                                                    setTimeout(() => {
                                                                                        typeMessage("If you want to order food on a train, just go below and click 'Order on Train'.", 4000, () => {
                                                                                            setTimeout(() => {
                                                                                                typeMessage("If you want to see your coupons, just go below and click 'Coupons'.", 4000, () => {
                                                                                                    setTimeout(() => {
                                                                                                        typeMessage("If you don't want my help, click 'Cookies Assist Help' below and turn me off. 🔕", 5000, () => {
                                                                                                            setTimeout(() => {
                                                                                                                typeMessage("If you need any help, just turn me on! 😊", 4000, callback);
                                                                                                            }, 3000);
                                                                                                        });
                                                                                                    }, 3000);
                                                                                                });
                                                                                            }, 3000);
                                                                                        });
                                                                                    }, 3000);
                                                                                });
                                                                            }, 3000);
                                                                        });
                                                                    }, 3000);
                                                                });
                                                            }, 3000);
                                                        });
                                                    }, 3000);
                                                });
                                            }, 3000);
                                        });
                                    }, 3000);
                                });
                            }, 3000);
                        });
                    }, 5000);
                });
            }, 4000);
        });
    });
}

// Show help message after 25 seconds of inactivity
setTimeout(() => {
    if (!isMessageActive) {
        isMessageActive = true;
        showHelpMessages(() => {
            isMessageActive = false;
        });
    }
}, 25000);

    </script>

    <footer class="footer">
        <div class="footer-menu">
            <a class="footer-button" href="N-foodinterfacepage.html">
                <img src="static/pngwing.com (19).png">
                <span>Dining</span>
            </a>
            <a class="footer-button" href="trackorder.html">
                <img src="static/pngwing.com (18).png">
                <span>Track</span>
            </a>
            <a class="footer-button" href="liveevent.html">
                <img src="static/icons8-live-50.png">
                <span>Events</span>
            </a>
            <div class="underline"></div> <!-- Moving underline -->
        </div>
    </footer>
</body>
</html>
